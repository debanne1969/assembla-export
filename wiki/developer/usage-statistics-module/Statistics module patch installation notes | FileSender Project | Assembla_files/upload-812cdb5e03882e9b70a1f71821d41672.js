window.jQuery=window.jQueryLatest,function(e){"use strict";function r(r,i){if(e(n).length>0)return;var s={id:t,type:"file","class":"display-none",accept:r.mimetypes||"*/*",multiple:!!r.multiple};e("<input />",s).appendTo("body").on("change",function(e){i(e.target.files,r)})}function i(t){return e("#upload-options").data(t)}function s(){return i("upload-file-url")}var t="simpleUpload",n="#"+t;window.SimpleUploadManager=function(){},SimpleUploadManager.prototype.directUpload=function(n,r){var i=r.moveTo||"",o={validate:!1,errorHandler:e.helpers.errorHandler},u={processData:!1,contentType:!1,xhrFields:{withCredentials:!0},beforeSend:function(t,r){var s=new FormData;s.append("document[file]",n),s.append("move_to",i),s.append(e("[name=csrf-param]").attr("content"),e("[name=csrf-token]").attr("content")),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.data=s}},a=e.helpers.restRequest(s(),"post",o,u);return _.isFunction(r.onSuccess)&&a.then(r.onSuccess),_.isFunction(r.onFail)&&a.fail(r.onFail),a},SimpleUploadManager.prototype.directUploadMultiple=function(t,n){var r=this;_.each(t,function(e){r.directUpload(e,n)})},SimpleUploadManager.prototype.initUpload=function(i){var s=this.directUploadMultiple.bind(this);r(i,s),e(n).val(null).click()}}(jQuery),function(e){"use strict";function a(e){return function(t){Array.isArray(t)||(t=[t]),t.forEach(function(t){f(t,e)})}}function f(t,n){if(!t.key)throw Error("no ASW file path found: Invalid local OR FileStack setup");var r={name:s.truncate(t.filename,197),filename:t.filename,filesize:t.size,content_type:t.mimetype,path:t.key},i=_.pick(n,"attachable_id","attachable_type","skip_create_comment");i.attachable_id&&i.attachable_type&&e.extend(r,i);var o={document:r};n.moveTo&&(o.move_to=n.moveTo);var u=v().urls.instant_upload,a=e.helpers.restRequest(u,"post",d({data:o}));_.isFunction(n.onSuccess)&&a.done(n.onSuccess),_.isFunction(n.onFail)&&a.fail(n.onFail)}function l(e){if(e.code===101)return;var t=_.isObject(e)&&e.hasOwnProperty("error")?e.error:e.toString();Breakout.alerter.show({message:t,type:"error"});if(!Breakout.AirbrakeClient)return;Breakout.AirbrakeClient.notify(e.toString())}function c(e){return _.isFunction(e)?function(t){l(t),e(t)}:l}function h(t){return t=t||{},e.extend({attachable_id:v().attachable.id,attachable_type:v().attachable.type},t)}function p(t){var n=v().store.path+e.helpers.generateUuid();if(t.name){var r=t.name.toString().replace(/[^a-z0-9-_\.]/gi,"");n+="_"+r,delete t.name}return e.extend({location:"S3",path:n},t)}function d(t){return t=t||{},e.extend({validate:!1},t)}function v(){return t=t||JSON.parse(e("#instant-upload-setup").text()),t}var t,n=["COMPUTER","BOX","DROPBOX","EVERNOTE","FACEBOOK","GMAIL","IMAGE_SEARCH","FLICKR","FTP","GITHUB","GOOGLE_DRIVE","SKYDRIVE","PICASA","URL","WEBCAM","INSTAGRAM","VIDEO","AUDIO","ALFRESCO","CUSTOMSOURCE","CLOUDDRIVE","IMGUR","CLOUDAPP"],r=["VIDEO","AUDIO"],i=["EVERNOTE","FACEBOOK","IMAGE_SEARCH","FLICKR","PICASA","WEBCAM","INSTAGRAM","AUDIO","IMGUR"],o=["FACEBOOK","IMAGE_SEARCH","FLICKR","PICASA","WEBCAM","INSTAGRAM","VIDEO","IMGUR"],u={"image/*":_.difference(n,r),"video/*":_.difference(n,i),"audio/*":_.difference(n,o),"*/*":n};window.InstantUploadManager=function(){filepicker.setKey(v().api_key)},InstantUploadManager.prototype.initUpload=function(t){t=t||{};var n=t.mimetypes||"*/*",r={policy:v().security.policy,signature:v().security.signature,mimetypes:n,container:"modal",services:u[n]},i=h(t),s=p({storeContainer:v().store.bucket});filepicker.pickAndStore(r,s,a(i),l)},InstantUploadManager.prototype.directUpload=function(t,n){var r=h(n),i=p({name:t.name,container:v().store.bucket,policy:v().security.policy,signature:v().security.signature});filepicker.store(t,i,a(r),c(r.onFail))},InstantUploadManager.prototype.directUploadMultiple=function(t,n){var r=this;_.each(t,function(e){r.directUpload(e,n)})}}(jQuery),function(e){"use strict";function t(){var e=Breakout.instantUploadEnabled?InstantUploadManager:SimpleUploadManager;window.UploadManager=new e}e(document).ready(function(){t()})}(jQuery),window.jQuery=window.jQueryOld;