
      
      
      
      
      
      
      
      <h1><span style="background-color: #ff0000;">Warning: this patch requires FileSender 1.5 !<br></span></h1>
<p> </p><h2>0. Requirements:</h2><ul><li>FileSender 1.5, min. beta4</li><li> Postgresql database.  MySQL support is being worked on<br></li></ul><p> <br></p>
<h1>1. download, unpack patch and set your filesender directory<br></h1>
<ul><li> download the patch.  Make sure you pick the patch that fits with YOUR filesender version.</li></ul><ul><li><p>unpack the patch:</p><pre>root@ip-10-227-11-137:~/filesender# tar xvzf filesender-1.5-beta4-statspatch-v1.tar.gz</pre></li><li><p>make the patch directory your active working directory:</p><pre>root@ip-10-227-11-137:~/filesender# cd filesender-1.5-beta4-statspatch-v1/<br>root@ip-10-227-11-137:~/filesender/filesender-1.5-beta4-statspatch-v1# <br><br></pre></li></ul><ul><li>edit "applypatch.sh" to point YOUR_FILESENDER_INSTALLATION_BASEDIR to the FileSender directory you'd like to patch. </li></ul><pre><br>#!bin/bash<br>set -x<br><br><span style="color: rgb(0, 0, 0); background-color: rgb(207, 226, 243);">YOUR_FILESENDER_INSTALLATION_BASEDIR='/root/statspatch/test/filesender-1.5-beta4'</span><br>PATCH_DIRECTORY='.'<br>PATCHNAME='filesender-1.5-beta4-statspatch-v1'<br><br>....<br></pre><p><br></p><h1><br></h1>
<h1>2. one time step: create new "stats" table<b></b></h1>
<p>Every time you run the cron_stats.php cronjob, the statistics module takes the new data from the Logs table, anonymises it and stores it in a new table called "stats".  Use the following command to create this new table in postgresql, grep your database name and database user + password from your filesender config.php:</p>
<pre>psql -h localhost <your database name> <your database user name><br><br>postgres@ip-10-227-11-137:~$ psql -h localhost filesender filesender < /root/filesender/filesender-1.5-beta4-statspatch-v1/scripts/filesender_db_statsmodule.sql<br>Password for user filesender: <br>NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "stats_pkey" for table "stats"<br>CREATE TABLE<br><span></span></pre>
<p> </p>
<h2>3. run applypatch.sh </h2><p>Run ./applypatch.sh to put all new files in the right (new) places and patch the  www/index.php, language/en_AU.php, www/classes/Functions.php and www/css/default.css</p><p> </p><p>Note: copy  <br></p><p> </p><h2>4. Include the statspatch configfile to your config/config.phpconfig.statspatch-dist.php new config directives to your config/config.php<span style="font-weight: normal;"> </span></h2><h2><span style="font-weight: normal;">The statspatch config file is installed to filesender/config-temlates/config.statspatch-dist.php, copy it to your config directory:<br></span></h2><pre><span style="font-weight: normal;">root@ip-10-227-11-137:~# cp /var/www/filesender/config-templates/config.statspatch-dist.php /var/www/filesender/config/config.statspatch.php<br></span><span style="font-weight: normal;">root@ip-10-227-11-137:~# chgrp www-data </span><span style="font-weight: normal;">/var/www/filesender/config/config.statspatch.php</span><span style="font-weight: normal;"> </span><span style="font-weight: normal;"> <br></span></pre><ul><li><h2><span style="font-weight: normal;"> Include the statspatch config file in your config.php using this line:</span></h2><pre><span style="font-weight: normal;">	include('config.stats-patch.php');<br></span></pre></li></ul><h2><span style="background-color: rgb(255, 0, 0);">Ensure the stats access level is according to your site's preferences.  It is set to public by default!</span><br></h2><pre>$config['stats_access_level'] = 'public'; // Who can access stats page. Possible settings are 'admin', 'user', 'public' or 'disabled'. A more restrictive setting here would override the access settings below.<br> <br></pre><h2>5. configure cron for the statistics module</h2><p> </p><p>Schedule the cronjob that'll update the stats database run once a day:</p><pre>echo "#!/bin/sh<br>>    php -q /usr/local/filesender/filesender/cron/cron-stats.php" > /etc/cron.daily/filesender-stats-update<br></pre> <p>If you want your stats cron job to hourly use this: </p><pre>echo "#!/bin/sh<br>>    php -q /usr/local/filesender/filesender/cron/cron-stats.php" > /etc/cron.hourly/filesender-stats-update</pre><h2 id="start_using_filesender">6. Wait until the cron job runs for the first time and look at your stats</h2><p style="padding-left: 30px;">https://yoursite/filesender/stats/</p><h2 id="support_and_feedback">Support and Feedback</h2><p>See <a class="wiki_link" title="Support and Mailinglists" href="http://www.assembla.com/wiki/show/file_sender/Support_and_Mailinglists">Support and Mailinglists</a> and <a class="wiki_link" title="Feature requests" href="http://www.assembla.com/wiki/show/file_sender/Feature_requests">Feature requests</a>. </p><p> </p>
    
    
    
    
    
    
